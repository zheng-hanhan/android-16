include($ENV{PW_ROOT}/pw_build/pigweed.cmake)

pw_add_library(chre.util STATIC
  HEADERS
    include/chre/util/always_false.h
    include/chre/util/array_queue.h
    include/chre/util/array_queue_impl.h
    include/chre/util/blocking_segmented_queue.h
    include/chre/util/buffer.h
    include/chre/util/buffer_base.h
    include/chre/util/conditional_lock_guard.h
    include/chre/util/conditional_lock_guard_impl.h
    include/chre/util/container_support.h
    include/chre/util/copyable_fixed_size_vector.h
    include/chre/util/duplicate_message_detector.h
    include/chre/util/dynamic_vector.h
    include/chre/util/dynamic_vector_base.h
    include/chre/util/dynamic_vector_impl.h
    include/chre/util/enum.h
    include/chre/util/fixed_size_vector.h
    include/chre/util/fixed_size_vector_impl.h
    include/chre/util/fragmentation_manager.h
    include/chre/util/fragmentation_manager_impl.h
    include/chre/util/hash.h
    include/chre/util/heap.h
    include/chre/util/heap_impl.h
    include/chre/util/host/assert.h
    include/chre/util/intrusive_list.h
    include/chre/util/intrusive_list_base.h
    include/chre/util/intrusive_list_impl.h
    include/chre/util/lock_guard.h
    include/chre/util/lock_guard_impl.h
    include/chre/util/log_common.h
    include/chre/util/macros.h
    include/chre/util/memory.h
    include/chre/util/memory_impl.h
    include/chre/util/memory_pool.h
    include/chre/util/memory_pool_impl.h
    include/chre/util/nested_data_ptr.h
    include/chre/util/non_copyable.h
    include/chre/util/optional.h
    include/chre/util/optional_impl.h
    include/chre/util/priority_queue.h
    include/chre/util/priority_queue_impl.h
    include/chre/util/raw_storage.h
    include/chre/util/scope_timer.h
    include/chre/util/scope_timer_impl.h
    include/chre/util/segmented_queue.h
    include/chre/util/segmented_queue_impl.h
    include/chre/util/singleton.h
    include/chre/util/singleton_impl.h
    include/chre/util/throttle.h
    include/chre/util/time.h
    include/chre/util/time_impl.h
    include/chre/util/toolchain.h
    include/chre/util/unique_ptr.h
    include/chre/util/unique_ptr_impl.h
  PUBLIC_INCLUDES
    include
  PUBLIC_DEPS
    chre.chre_api
    chre.platform.assert
    chre.platform.memory
    chre.platform.system_time
    chre.util.nanoapp
    chre.variant.config

    # TODO(b/376249597) Move the synchronized expandable memory pool, fixed
    # size blocking queue, and synchronized memory pool to chre.util.system.
    chre.platform.condition_variable
    chre.platform.mutex
  SOURCES
    buffer_base.cc
    duplicate_message_detector.cc
    dynamic_vector_base.cc
    hash.cc
    intrusive_list_base.cc
)

pw_add_library(chre.util.flatbuffers INTERFACE
  HEADERS
    include/chre/util/flatbuffers/helpers.h
  PUBLIC_INCLUDES
    include
  PUBLIC_DEPS
    chre.util
    chre.variant.config
    chre_third_party.flatbuffers
)

pw_add_library(chre.util.host INTERFACE
  HEADERS
    include/chre/util/host/assert.h
  PUBLIC_INCLUDES
    include
)


pw_add_library(chre.util.nanoapp STATIC
  HEADERS
    include/chre/util/nanoapp/app_id.h
    include/chre/util/nanoapp/assert.h
    include/chre/util/nanoapp/audio.h
    include/chre/util/nanoapp/ble.h
    include/chre/util/nanoapp/callbacks.h
    include/chre/util/nanoapp/debug.h
    include/chre/util/nanoapp/log.h
    include/chre/util/nanoapp/math.h
    include/chre/util/nanoapp/string.h
    include/chre/util/nanoapp/tagged_log.h
    include/chre/util/nanoapp/wifi.h
  PUBLIC_INCLUDES
    include
  PUBLIC_DEPS
    chre.chre_api
    chre.platform.assert
    chre.platform.log
    chre.platform.tagged_log
    chre.util
    chre.variant.config
    pw_tokenizer
  SOURCES
    nanoapp/audio.cc
    nanoapp/ble.cc
    nanoapp/callbacks.cc
    nanoapp/debug.cc
    nanoapp/string.cc
    nanoapp/wifi.cc
)

pw_add_library(chre.util.pigweed STATIC
  HEADERS
    include/chre/util/pigweed/chre_channel_output.h
    include/chre/util/pigweed/permission.h
    include/chre/util/pigweed/rpc_client.h
    include/chre/util/pigweed/rpc_common.h
    include/chre/util/pigweed/rpc_helper.h
    include/chre/util/pigweed/rpc_server.h
  PUBLIC_INCLUDES
    include
  PUBLIC_DEPS
    chre.chre_api
    chre.util
    chre.util.nanoapp
    chre.variant.config
    pw_rpc.client
    pw_rpc.common
    pw_rpc.server
    pw_span
  SOURCES
    pigweed/chre_channel_output.cc
    pigweed/rpc_client.cc
    pigweed/rpc_helper.cc
    pigweed/rpc_server.cc
  PRIVATE_DEPS
    pw_status
)

pw_add_library(chre.util.system STATIC
  HEADERS
    include/chre/util/system/atomic_spsc_queue.h
    include/chre/util/system/ble_util.h
    include/chre/util/system/chre_error_util.h
    include/chre/util/system/debug_dump.h
    include/chre/util/system/error_util.h
    include/chre/util/system/event_callbacks.h
    include/chre/util/system/fixed_size_blocking_queue.h
    include/chre/util/system/fixed_size_blocking_queue_impl.h
    include/chre/util/system/message_common.h
    include/chre/util/system/message_router.h
    include/chre/util/system/napp_header_utils.h
    include/chre/util/system/napp_permissions.h
    include/chre/util/system/ref_base.h
    include/chre/util/system/service_helpers.h
    include/chre/util/system/shared_ptr.h
    include/chre/util/system/shared_ptr_impl.h
    include/chre/util/system/synchronized_expandable_memory_pool.h
    include/chre/util/system/synchronized_expandable_memory_pool_impl.h
    include/chre/util/system/synchronized_memory_pool.h
    include/chre/util/system/synchronized_memory_pool_impl.h
    include/chre/util/system/stats_container.h
    include/chre/util/system/system_callback_type.h
    include/chre/util/system/transaction_manager.h
    include/chre/util/system/transaction_manager_impl.h
    include/chre/util/system/wifi_util.h
  PUBLIC_INCLUDES
    include
  PUBLIC_DEPS
    chre.chre_api
    chre.core
    chre.platform.assert
    chre.platform.atomic
    chre.platform.memory
    chre.platform.mutex
    chre.platform.system_time
    chre.util
    chre.variant.config
    pw_allocator.deallocator
    pw_containers.vector
    pw_intrusive_ptr
  SOURCES
    system/ble_util.cc
    system/error_util.cc
    system/event_callbacks.cc
    system/debug_dump.cc
    system/message_router.cc
    system/service_helpers.cc
  PRIVATE_DEPS
    chre.platform.log
)
